audio-analyzer/
│
├── index.html                  # Основная HTML-разметка
├── style.css                   # Стили страницы
├── css/
│   ├── audioGenerator.css
├── js/
│   ├── records/                # Записи загружаются при старте
│   │   ├── rec1.wav
│   │   ├── ...
│   ├── AudioStorage.js         # Хранилище звуков
│   ├── AudioGenerator.js       # генерация звука
│   ├── AudioGeneratorInit.js   # старт генертора, привязка к html
│   ├── AudioRecoder.js         # запись звука с микрофона
# прослушка звука с микрофона
# запись звука в массив
# отображение массива в списке
# анализ звука
# передача звука на колонки
├── main.js             # Менджер звуков - объединяет все звуковые классы
├── script.js           # Логика записи, воспроизведения и анализа
└── arch.md             # Схема проекта

# Анализатор звука (запись + анализ в реальном времени)

Веб-приложение для работы со звуком: запись, генерация, воспроизведение, анализ
Построено на чистом HTML, CSS и JavaScript с использованием Web Audio API.

## Возможности

- Запись аудио с микрофона (кнопки «Начать запись» / «Остановить запись»).
- Сохранение записи и встроенный аудиоплеер с перемоткой.
- Анализ RMS (среднеквадратичной амплитуды) в реальном времени во время воспроизведения.
- Отображение графика изменения RMS и текущего значения.

## Структура проекта

- `index.html` – основная разметка страницы.
- `style.css` – стили для кнопок, блоков анализа, адаптация под мобильные.
- `script.js` – логика записи, воспроизведения и анализа (с подробными комментариями).
- `README.md` – документация.

## Как запустить

1. Скачайте все файлы в одну папку.
2. Откройте `index.html` в современном браузере (Chrome, Firefox, Edge, Safari).
3. Разрешите доступ к микрофону.
4. Нажмите **Начать запись**, говорите что-то в микрофон.
5. Нажмите **Остановить запись** – появится плеер.
6. Нажмите **Play** на плеере – начнётся воспроизведение и анализ RMS.


## AudioGenerator -> AudioBuffer

  Класс для генерации звуковых сигналов с использованием Web Audio API.

  - generate(options) - Генерирует AudioBuffer на основе переданных параметров.

  - play(options) - Воспроизводит сгенерированный звук через AudioContext.

  - download(options, filename) - Сохраняет сгенерированный звук в WAV файл и скачивает. -> AudioStorage

## AudioGeneratorInit.js
  - getBasicOptions() формирует обьект options из формы html
  - обработчики кнопок playBtn, saveBtn, downloadBtn

## AudioStorage <- AudioBuffer

  Класс для хранения записей
  для добавления новой запись надо сохранить в папку и прописать путь (в разработке)


# new version
пишу проект на js html css, задача проекта дать пользователю возможность
сгенерировать звук по опреденным параметрам
записать звук своего голоса,
сравнить свой голос с генерированным звуком,
конечная цель создание шаблонов аудио сигнала, который будет использоваться
для распознования сигналов голосом, а так же тренировка голоса для повторения
аудио сигналов

классы
AudioBuffer -> Stream
## Generator - (дополнение 1) работает непрерывно
имеет одну функции генерации звуков,
generate(options) возвращает AudioBuffer заданного размера
функции вкл/выкл - (дополнение 1) останавливает непрерынвый поток
  options в форме массива объектов, если объектов много то комбинируются гармоники
  options.кривые = {type: 'sine',frequency: 220,amplitude: 0.5} - возможно не все параметры переданы
  options.filter и другие общие параметры , которые могут понадобиться

## Microphone - работает непрерывно
подключается к микрофону и ассинхронно возвращает AudioBuffer
функции вкл/выкл - (дополнение 1) останавливает захваст с микрофона

## Modulator
принимает AudioBuffer Generator, Microphone или Storage или одного из них
объединяет и возвращает объединенные AudioBuffer

## Analyzer
функции: принять AudioBuffer и проанализировать его различными способами
формируя графики и рассчитывая различные показатели (дополнение 1) если есть поток аудио работает всегда

## Player
выводит AudioBuffer на колонки
функции вкл/выкл - (дополнение 1) остановка вывода звука в колонки (при этом сам поток работает идет в Analyzer например)

## Recorder
запись фрагментов в определенный формат
функции вкл/выкл

## AudioComparator
сравнение двух AudioBuffer
Generator + Microphone
Modulator + Microphone
Modulator + Generator
Generator + Storage и т.д задача показать, что звуки похожи

## AudioCatcher
содержит набор звуков (комбинаций), если поступающий звук похож на звук из набора
сигнализирует об этом

## Storage
хранение музыкальных фрагментов
функции:
воспроизвести (стандартная библиотека html <audio>)
скачать - при условии что есть флаг такой возможности
удалить - при условии что есть флаг такой возможности
вернуть AudioBuffer
так как система работает через файловую систему и действуют CORS ограничения,
то при старте страницы в Storage будут звуки, прописанные в html пользователем
у них не будет возможности удалить и скачать
другие звуки будут добавляться из recorder у них есть возможность скачать и удалить

## Orchestrator
руководит процессами
Порядок работы
  1 запустить Generator - опционально
  2 запустить Microphone - опционально
  3 принятые от Generator и Microphone фрагменты передать в Modulator
  4 из Modulator звук передается в Analyzer
  5 из Modulator звук передается в Player - опционально
  6 запуск Recorder при включенных (если п.1 или п.2 вкл)
  7 сохранение фрагменты из Recorder в Storage
  8 получение фрагментов из Storage для передачи в Modulator
  9 постоянна передача звука в AudioCatcher

html разметка сожержит блоки:

1 Настройка Generator-а - опции которые пользователь вводит в форму
  для генерации звука {[{тип волны, частота, амплитуда}], фильтры} и кнопка
  сохранить, при сохранении показатели меняют значения в генераторе, что приводит к
  изменению звука в режиме онлайн

2 блок управления содержит кнопки:
  включить/выключить Generator,
  включить/выключить Microphone,
  включить/выключить Play
  включить/выключить Record

3 блок анализа содержит график амплитуды RMS и другие показатели, которые могут помочь
  в достижении цели проекта

4 блок Storage - список аудиозаписей в тегах audio

5 Блок AudioComparator содержит набор звуков в виде названия в прямоугольной рамке
 когда звук из любого источника (Generator, Microphone, Storage) совпадает с шаблоном
 из AudioCatcher то прямоугольник подсвечивается

вот дополнения промта, сформируй предварительный промт, а так же найди места в которых можно трактовать моменты
по разному:
AudioBuffer меняем на Stream, то есть Generator, Microphone, Modulator создают неприрывный поток
обрабатываемый через AudioWorklet или ScriptProcessorNode
так же если мы хотим взять запись из Storage она переформатируется под необходимый вид для возможности анализа

options объект, в котором гармоники передаются в форме массива
если гармоника одна, то передается обычный поток осцилятора или чего то там
если гармоник много, то происходит Микширование гармоники
options.кривые = {type: 'sine',frequency: 220,amplitude: 0.5} - возможно не все параметры переданы
options.filter и другие общие параметры , которые могут понадобиться

класс Modulator микширует потоки из всех активных источников, а именно Generator/Microphone/Storage
и этот поток идет а Analyzer затем если Player активен то на колонки, если активен Recorder, то
в память -> новая запись в storage

Перечень анализируемых показателей Analyzer RMS Спектр, частота основного тона, огибающая, кепстр и т.д.
я не сталкивался с анализом звука, по этому полагаюсь на чужие знание в этой области, необходимы все возможные
варианты (с учетом цели проекта), после изучения и ознакомления я буду отсекать ненужные.
Analyzer рассчитывает числовые показатели (массив частот, RMS и тд) и возвращает их. Отрисовку графиков выполняет отдельный UI-компонент, подписанный на данные Analyzer

Recorder записывает данные из Modulator, запись ведется если пользователь ее активировал и идет поток, формат
записи нужно выбрать изходя из простоты следующего: сравнить запись с активным потоком генератора и голоса
длительность записи регулируется пользователем кнопками старт и стоп

AudioComparator / AudioCatcher
Сравнивать основную частоту (Fundamental Frequency) входного сигнала с частотой эталона. Если разница менее 5% (или 10 центов), считать совпадением
так же добавить другие критерии сравнения опять же для поиска оптимального для решения поставленой задачи например: Корреляция, спектральное расстояние

звуки для набора пользователь берет из Storage

вопросы по Storage - при инициализации звуки беруться из html, где пользователь сам прописал теги <audio> с src
воспроизведение из самого списка происходит стандартным методом, если звуки получены из Recorder, то они преобразуются в самый удобный формат (менее трудозатратный) с точки зрения последующего сравнения в AudioComparator / AudioCatcher
все встроенные звуки будут с признаком, который означает что их нельзя скачать или удалить, у новых звуков
(из Recorder) этот признак будет противоположным

AudioComparator - сравнивает два звука определенным способом, и выдает степень похожести
AudioCatcher - содержит эталонные звуки и если AudioComparator нашел похожесть с каким то звуком, то
AudioCatcher сигнализирует - это путем подсветки соответствующего элемента в своем списке

Orchestrator п.1 и п.2 «запустить» / остановить пользователь сам переключает каждый объект через html кнопками
вопросы про фрагменты звуков не актуальны так как работаем с потоком stream. recorder управляется пользователем
передача из Storage в Modulator не происходит, нет смысла микшировать эти звуки в рамках этого проекта предыдущие уточнения по этому процессу считать неактуальными

AudioCatcher работает всегда и с эталонными звуками сравниваются потоки из Modulator

HTML-блоки Generator - Блок 1 фильтры ФНЧ, ФВЧ

анализ - кроме графика RMS должны быть еще показатели/графики, которые были упомянуты в проекте и способствоют
достижению целей

AudioComparator - это просто класс сравнения ровно двух звуков. он может вызываться AudioCatcher в котором содержаться звуки из Storage. AudioComparator инофрмирует AudioCatcher, а AudioCatcher информирует пользователя

доп 2

Следует уточнить, как устанавливаются параметры генерации (например, частота, амплитуда, форма волны). Должны ли они передаваться через конструктор или могут меняться динамически?


ответы qwen:
1 AudioCatcher - вообще нужно сравнивать чистый поток Microphone с Эталоном
в Modulator микширование потоков не происходит если поток один, то есть, когда пользователь сравнивает
свой голос с эталоном, он отключает генератор, при этом у него остается возможность
микшировать голос и сгенерированный звук для понимания вознникает ли "унисон" или других наблюдений

2 Реализация "Потока" для сравнения (Stream vs Buffer) размер окна анализа скользящего потока сделать
 настраиваемым либо соответвующим следующей задаче:
голосовые команды могут быть быстрые до 1сек, двойные - два последовательных звучания общей протяженностью
1-2 секунды или долгими, одно монотонное звучание от 2 секунд но неизменное до самого окончания
как я понял каждые 100мс надо брать Buffer размером 2048/ 4096 сэмплов - и эти два числа настраиваются
в конструкторе класса

3 Хранение в Storage (IndexedDB vs HTML) сам проект запускается на файловом сервере <audio src="...">
ссылка будет указана пользователем на файл в соседней папке, скороее всего там будет около 30 коротких звуков.
физически данные Recorder будем хранить в IndexedDB, внешних ссылок не будет

4 Как именно Analyzer передает данные UI на отрисовук выбирается с учетом способа развертки проекта. Проект запускается на файловом сервере, значит нужен способ без конфликта с CORS и без запуска сервера. EventEmitter
вроде требует запуска сервера Node.js если нет то выбираем этот способ

5. Алгоритм Pitch Detection (Определение тона) надо реализовать несколько алгоритмов сравнения YIN, MCYIN, Autocorrelation, можно реализовать их параллельно, то есть у каждого эталонного значения будет несколько окошек и если один из алгоритмов говорит что звуки похожи, то окошко становиться активным

6. Фильтры в Generator если я правильно понимаю фильтр удаляет из звука ненужные частоты, а если мы сами
генерируем звук, то эти частоты мы не будем указывать специально, то есть у генератора фильтр частот просто
 бесполезен. в таком случае необходимо перенести настройку фильтрв в микрофон, а так же добавить другие настройки типа сглаживания и какие еще есть в этой области

7. Инициализация AudioContext Инициализация AudioContext происходит только после первого клика пользователя по любой кнопке управления

8. Формат записи Recorder Хранить внутри системы Raw PCM для скорости, а WAV генерировать только на лету при кнопке "Скачать"

* Хранение буферов в Storage. буферы из Storage можно при необходимости загружать из Blob, записи AudioCatcher
хранятся в памяти

* Инициализация встроенных записей через парсинг атрибутов тегов <audio>  src

* Режим генератора если добавляется новая гармоника, то надо пересоздавать цепочку

* Analyzer вычисляет значения по таймеру. UI подписывается на события обновления.
